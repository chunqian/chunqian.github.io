# 9.1.宏上下文

> 定义：宏上下文
> 宏的上下文是宏被执行的环境。根据宏的类型，它可以被认为是一个类被构建，或者一个函数被类型化。上下文的信息可以通过 haxe.macro.Context API 获得。

Haxe 的宏根据宏的类型有对不同上下文信息的访问。除了查询这些信息，上下文也允许一些修改比如定义一个新的类型或者注册某个回调。重要的是，理解不是所有信息对所有种类的宏都可用，就如后面例子所证明的：

- 初始化宏将发现 Context.getLocal*() 方法返回 null 。没有局部类型或者方法在初始化宏的上下文中。
- 只有构建宏从 Context.getBuildFields() 方法得到正确的返回值。对于其它种类的宏没有字段被构建。
- 构建宏有一个局部类型（如果不完全的），但是没有局部方法，所以 Context.getLocalMethod() 返回 null 。

上下文API被 haxe.macro.Compiler API 补充，在初始化宏（第9.7节）中详述。而这个API可以用于所有宏的种类，必须注意初始化宏的任何外部修改。这源于未定义的构建顺序（第9.6.3节）的自然限制，可能导致如一个标记定义通过 Compiler.define() 在一个对应这个标记的条件编译检查之前或之后生效。